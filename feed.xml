<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>MyRealBook</title>
    <link href="https://myrealbook.vintherine.org/feed.xml" rel="self" />
    <link href="https://myrealbook.vintherine.org" />
    <updated>2022-07-31T12:57:10+02:00</updated>
    <author>
        <name>Vincent</name>
    </author>
    <id>https://myrealbook.vintherine.org</id>

    <entry>
        <title>Passage en version 2.23 de Lilypond</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/passage-en-version-223-de-lilypond.html"/>
        <id>https://myrealbook.vintherine.org/passage-en-version-223-de-lilypond.html</id>

        <updated>2022-07-31T12:57:10+02:00</updated>
            <summary>
                <![CDATA[
                    <p>Fidèle à ma distribution <a href="https://fr.wikipedia.org/wiki/Arch_Linux">ArchLinux</a> depuis de nombreuses années j'ai toujours utilisé son gestionnaire de paquets (pacman), ou si besoin à son dépôt communautaire <a href="https://wiki.archlinux.org/title/Arch_User_Repository_(Fran%C3%A7ais)">AUR</a>, pour installer les applications dont j'ai besoin. Le paquet officiel de Lilypond d'ArchLinux est la version stable 2.22.2, j'étais donc en 2.22.2. De plus rappelons que Lilypond n'est pas un logiciel Wysiwyg mais offre un langage de description de la musique qu'il compile ensuite sous forme de partition. Un changement de version demande donc un certain investissement personnel pour assimiler les évolutions de ce langage, même s'il existe un outil de conversion (<a href="https://lilypond.org/doc/v2.23/Documentation/usage/updating-files-with-convert_002dly.fr.html">convert-ly</a>) par ailleurs très facile à utiliser avec l'éditeur <a href="https://fr.wikipedia.org/wiki/Frescobaldi_(logiciel)">Frescobaldi</a>. </p>
<p>Toutefois une successions de nouveautés dans la version de développement (2.23.x) de Lilypond m'a convaincu d'abandonner mon confort et de franchir le pas.</p>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Fidèle à ma distribution <a href="https://fr.wikipedia.org/wiki/Arch_Linux">ArchLinux</a> depuis de nombreuses années j'ai toujours utilisé son gestionnaire de paquets (pacman), ou si besoin à son dépôt communautaire <a href="https://wiki.archlinux.org/title/Arch_User_Repository_(Fran%C3%A7ais)">AUR</a>, pour installer les applications dont j'ai besoin. Le paquet officiel de Lilypond d'ArchLinux est la version stable 2.22.2, j'étais donc en 2.22.2. De plus rappelons que Lilypond n'est pas un logiciel Wysiwyg mais offre un langage de description de la musique qu'il compile ensuite sous forme de partition. Un changement de version demande donc un certain investissement personnel pour assimiler les évolutions de ce langage, même s'il existe un outil de conversion (<a href="https://lilypond.org/doc/v2.23/Documentation/usage/updating-files-with-convert_002dly.fr.html">convert-ly</a>) par ailleurs très facile à utiliser avec l'éditeur <a href="https://fr.wikipedia.org/wiki/Frescobaldi_(logiciel)">Frescobaldi</a>. </p>
<p>Toutefois une successions de nouveautés dans la version de développement (2.23.x) de Lilypond m'a convaincu d'abandonner mon confort et de franchir le pas.</p>

<ul>
<li>Tout d'abord  – j'y reviendrai longuement dans de prochains articles – l'édition de grilles harmoniques <a href="https://myrealbook.vintherine.org/grille-harmonique.html">évoqué ici récemment</a>, est maintenant intégrée dans l'application (plus besoin d'inclure un fichier de fonction). Elle repose maintenant sur la notation proportionnelle qui assure un rendu impeccable. Dans la mesure où je suis grandement à l'origine du projet par mes demandes incessantes sur la <a href="https://lists.gnu.org/mailman/listinfo/lilypond-user-fr">liste de discussion des utilisateurs francophones de Lilypond </a>je me devais pour le moins de tester le travail remarquable de notre ami Jean Abou Samra. Voir ici la <a href="https://lilypond.org/doc/v2.23/Documentation/notation/displaying-chords.html#chord-grids">page de documentation</a> (pas encore traduite en français). <br>À ma connaissance Lilypond est le seul éditeur de partition à proposer cette fonctionnalité.</li>
<li>Ensuite la distribution des versions de développement se fait maintenant sous forme de binaires dans un fichier compressé (tar.gz sous Linux, zip sous Windows et "j'y comprends rien" sous Mac). Il suffit de décompresser n'importe où, de mettre dans son path ou d'en avertir Frescobaldi et hop, ça roule ! De plus c'est un très bon moyen de faire coexister plusieurs versions. <br>N.B. si vous utilisez LilyJazz pensez à copier les fonts dans le dossier share/lilypond/2.23.x/fonts. <br>La <a href="#INTERNAL_LINK#/post/null" title="https://lilypond.org/doc/v2.23/Documentation/web/development">page de téléchargement de la version de développement</a>. Et<a href="https://lilypond.org/doc/v2.23/Documentation/learning/installing"> un peu de documentation (en anglais) ici</a>. </li>
</ul>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/31/2022-07-31-1659260303_877x233_scrot.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/31/responsive/2022-07-31-1659260303_877x233_scrot-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/31/responsive/2022-07-31-1659260303_877x233_scrot-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/31/responsive/2022-07-31-1659260303_877x233_scrot-md.png 768w"  alt="Paramétrage de Frescobaldi" width="855" height="224"><figcaption>Paramétrage de Frescobaldi</figcaption></figure>
<ul>
<li>Une des annonces qui me faisait saliver était la gestion des reprises du type Da Capo (ou Dal Segno) al Coda. Sur ce point j'avoue rester nettement sur ma faim : difficile à personnaliser et incompatible avec d'autres indications textuelles de système. N'utilisant que très peu le rendu midi (pour lequel cette nouvelle fonctionnalité est un progrès réel) je continuerai pour le moment à les gérer avec <a href="https://myrealbook.vintherine.org/double-marks.html">Polymark</a>.</li>
<li>Enfin il est vraisemblable que Jean prends un certain plaisir à rendre obsolètes mes articles au fur et à mesure qu'ils paraissent. C'est le cas par exemple de <a href="https://myrealbook.vintherine.org/indication-de-swing.html">Indication de Swing</a> puisque cette fonctionnalité d'indication rythmique est elle aussi intégrée dans la dernière version. C'est beaucoup plus simple à utiliser. Par exemple : <figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/31/document-2.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/31/responsive/document-2-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/31/responsive/document-2-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/31/responsive/document-2-md.png 768w"  alt="" width="130" height="33"></figure></li>
</ul>
<pre><code>\version "2.23.11"</code><br><code>\include "lilyjazz.ily"</code><br><code>\markup { Swing \hspace #1 \rhythm { 8[ 8] } = \rhythm { \tuplet 3/2 { 8[ 8 8] } } }</code></pre>
<p>Il y a bien d'autres nouveautés : <a href="https://lilypond.org/doc/v2.23/Documentation/changes/index.fr.html">description ici</a>. </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Marques de repères et de reprises (Rehearsal Marks)</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/double-marks.html"/>
        <id>https://myrealbook.vintherine.org/double-marks.html</id>

        <updated>2022-07-08T08:04:18+02:00</updated>
            <summary>
                <![CDATA[
                    <p>C'est ce qu'on appelle un marronnier (sujet qui revient régulièrement) : comment gérer les marques de repères et de reprises (reheasal marks), leurs positions verticales et horizontales, comment les faire apparaître en fin de ligne, comment mettre deux marques successivement... Le besoin le plus fréquemment exprimé est une ligne se terminant par un "D.C. al Coda", la suivante commençant par la Coda en question. </p>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/DCalCoda.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/DCalCoda-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DCalCoda-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DCalCoda-md.png 768w"  alt="" width="501" height="184"></figure>
<p>Voici un petit tour de mes modestes connaissances  :</p>
<ul>
<li><a href="#mark">la commande \mark et ses (nombreux) \override</a></li>
<li><a href="#double">Double-Mark : deux marques à un saut de ligne</a></li>
<li><a href="#poly">PolyMark, un graveur alternatif</a></li>
</ul>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>C'est ce qu'on appelle un marronnier (sujet qui revient régulièrement) : comment gérer les marques de repères et de reprises (reheasal marks), leurs positions verticales et horizontales, comment les faire apparaître en fin de ligne, comment mettre deux marques successivement... Le besoin le plus fréquemment exprimé est une ligne se terminant par un "D.C. al Coda", la suivante commençant par la Coda en question. </p>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/DCalCoda.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/DCalCoda-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DCalCoda-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DCalCoda-md.png 768w"  alt="" width="501" height="184"></figure>
<p>Voici un petit tour de mes modestes connaissances  :</p>
<ul>
<li><a href="#mark">la commande \mark et ses (nombreux) \override</a></li>
<li><a href="#double">Double-Mark : deux marques à un saut de ligne</a></li>
<li><a href="#poly">PolyMark, un graveur alternatif</a></li>
</ul>

<h3 id="mark">La commande \mark et ses (nombreux) \override</h3>
<p>Commençons par le commencement : une marque de repère s'obtient par la commande <code>\mark</code> Voici ce qu'en dit la <a href="https://lilypond.org/doc/v2.22/Documentation/notation/writing-text#text-marks">documentation</a> :</p>
<p class="msg msg--highlight ">Le résultat de <code>\mark</code> n’apparaîtra que sur la portée supérieure d’un système. Si vous introduisez la commande <code>\mark</code> au moment d’une barre de mesure, la marque se placera au-dessus de la barre. Si vous y faites appel au milieu d’une mesure, cette marque sera positionnée entre les notes. Si elle intervient en début de ligne, elle sera placée juste avant la première note de cette portée. Enfin, une marque qui tomberait sur un saut de ligne sera imprimée au début de la ligne suivante. </p>
<p>Ce qui n'est pas précisément explicité c'est que sauf dispositif complémentaire  il n'est pas possible de placer plus d'une marque au même endroit.</p>
<p>Il est possible par des <code>\override</code> de modifier les comportements par défaut</p>
<ul>
<li>Direction (haut / bas)
<ul>
<li>Haut (défaut)  : <code>[\once] \override Score.RehearsalMark #'direction = #UP</code></li>
<li>Bas  :  <code>[\once] \override Score.RehearsalMark #'direction = #DOWN</code></li>
</ul>
</li>
<li>Alignement (gauche / centre / droit)
<ul>
<li>Gaughe : <code>[\once] \override Score.RehearsalMark #'self-alignment-X = #LEFT</code></li>
<li>Centre (défaut) : <code>[\once] \override Score.RehearsalMark #'self-alignment-X = #CENTER</code></li>
<li>Droit :  <code>[\once] \override Score.RehearsalMark #'self-alignment-X = #RIGHT</code></li>
</ul>
</li>
<li>Fin de ligne
<ul>
<li><code>\once \override Score.RehearsalMark.break-visibility = #end-of-line-visible</code></li>
</ul>
</li>
</ul>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/Directions.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/Directions-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/Directions-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/Directions-md.png 768w"  alt="" width="546" height="260"></figure>
<p>Si l’alignement se fait par défaut sur la barre de mesure il est possible de choisir  un autre objet tel que clef, armure, métrique, respiration...</p>
<p>Par exemple : </p>
<ul>
<li><code>[\once] override Score.RehearsalMark.break-align-symbols = #'(clef)</code></li>
<li><code>[\once] \override Score.RehearsalMark.break-align-symbols = #'(time-signature)</code></li>
</ul>
<p>extrait de la  <a href="http://lilypond.org/doc/v2.22/Documentation/notation/aligning-objects#using-the-break_002dalignable_002dinterface">documentation </a> : </p>
<p class="msg msg--highlight ">Les différents objets sur lesquels l’alignement pourrait intervenir seront regroupés dans une liste. Si l’un des objets est invisible à l’endroit voulu, en raison d’un réglage de <code>break-visibility</code> ou bien par forçage de la visibilité des armures et clefs, le repère ou le numéro de mesure viendra s’aligner sur le premier élément de cette liste qui soit visible. Dans le cas où aucun objet de la liste n’est visible, l’alignement se fera sur la barre de mesure ou, dans le cas où la barre de mesure est invisible, à l’endroit même où la barre prendrait place. </p>
<p>Enfin la propriété <code>extra-offset</code> offre la possibilité de contrôler entièrement le placement d’un objet, aussi bien horizontalement que verticalement. :</p>
<ul>
<li>[<code>\once] \override Score.RehearsalMark.extra-offset = #'(X . Y)</code></li>
</ul>
<p>X et Y sont des nombres décimaux permettant de déplacer vers la droite / vers le haut s'ils sont positifs, vers la gauche / vers le bas s'ils sont négatif.</p>
<h3 id="double">Double-Mark : deux marques à un saut de ligne</h3>
<p>Double-Mark est une fonction écrite par ArnoldTheresius pour gérer spécifiquement deux marques successives lors d'un saut de lignes (l'une avant l'autre après).  Elle est disponible sur <a href="https://lsr.di.unimi.it/LSR/Item?id=977">cette page de lsr</a> (un clic sur l'image affiche le code). Enregistrez-la dans un fichier à inclure. Sa syntaxe :</p>
<pre><code>\doubleMark</code><br><code>   texte ou \markup</code><br><code>   texte ou \markup</code></pre>
<p>La marque avant le saut de ligne sera alignée à droite, celle après le saut de ligne à gauche et toutes deux seront positionnées par défaut au dessus du système de portées. Il est possible de modifier la direction haut / bas  par un appel préalable à une fonction complémentaire <code>\set_mark-y-dir</code> que l'on trouve sur la même page.</p>
<p class="msg msg--success"><strong>Préalable</strong> : \set_mark-y-dir fonctionne parfaitement (lilypond 2.22.2) si ce n'est que Frescobaldi lisant quelque-chose commençant par \set  s'attend à un signe égal avant l'argument et perd tous ses moyens tant en matière d’indentation que d’autocomplétion. Une manière simple de contourner le problème est de rebaptiser mark-y-dir la fonction <strong>dans le fichier inclus</strong> en supprimant le set du début. <strong>C'est sous cette forme que j'y ferai référence</strong>. </p>
<p>La commande prend en paramètre optionnel une "alist" de paire d'arguments dont le premier est la position par rapport au point d'insertion (avant = left, après = right) et le second la position verticale (au dessus = UP, au dessous = DOWN). Pour indiquer par exemple un "D.C. al coda" en dessous de la portée puis, après le saut de ligne, un signe coda au dessus de la portée (image en haut de page) :</p>
<pre><code>include "double-mark.ly"<br><br>\relative c'' {
    c2 c c c \break
    \mark-y-dir #`(  (,left . ,DOWN) (,right . ,UP) 
    \doubleMark
    \markup  {\with-color #red "D.S. al Coda" }
    \markup { \with-color #red  \musicglyph "scripts.varcoda" }
    c c c c \bar ".." 
}</code></pre>
<p>Ceci est assez peu intuitif puisque après un saut de ligne les valeurs gauche et droite nous paraissent inversées mais on fini par s'y faire.</p>
<p class="msg msg--success"><strong>Attention</strong> :<code>\mark-y-dir</code> fait un <code>\override</code> de <code>Score.RehearsalMark.before-line-breaking</code> qui influencera sur les <code>\mark</code> suivants. Dans ce cas penser à faire un <code>\revert Score.RehearsalMark.before-line-breaking</code>.</p>
<h3 id="poly">PolyMark, un graveur alternatif</h3>
<p>C'est à ce même ArnoldTheresius que nous devons PolyMark qui se présente comme un graveur alternatif à \mark. On le trouve sur <a href="https://lsr.di.unimi.it/LSR/Item?id=976">cette page lsr</a>. Il semble au premier abord un peu plus complexe à prendre en main mais dès qu'on a compris son fonctionnement  il ressemble fort à la solution universelle. </p>
<p>la commande : <code>\polyMark #'identifiant [texte ou \markup]</code></p>
<p>Pour résumer on peut mettre autant de marques à un même point d'insertion pour autant qu'elle aient des mêmes identifiants différents. Pour afficher un repère  <code>\polyMark \default</code> fonctionne mais pas <span style="text-decoration: line-through;"><code>\polyMark #1</code> .</span></p>
<p>En l'absence d'indications de direction et d'alignement les valeurs par défaut sont <em>centré</em> et <em>au dessus</em>. En cas de multiples marques celles-ci seront alors empilées.</p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\relative c'' {</code><br><code>    c2 c \polyMark \default</code><br><code>    c2 c</code><br><code>    \polyMark #'myKey "something"</code><br><code>    \polyMark #'anotherKey \markup "something else"</code><br><code>    c c</code><br><code>}</code></pre>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/DoublePolyMark.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/DoublePolyMark-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DoublePolyMark-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/DoublePolyMark-md.png 768w"  alt="" width="522" height="120"></figure>
<p>Il est possible d'indiquer de différentes manières directions et alignements.</p>
<p>La manière basique (mais pas la plus simple) :</p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\relative c'' {</code><br><code>  c c \polyMark #'W "Default" c c \break</code><br><code>  \polyMark #'(X (direction . -1) (self-alignment-X . -1.0) )  "New Line"</code><br><code>  \polyMark #'(Y (direction . -1) (self-alignment-X . 1.0) (break-visibility . #(#t #f #f)))  "Down"</code><br><code>  \polyMark #'(Z (self-alignment-X . 1.0) (break-visibility . #(#t #f #f)))  "Up"</code><br><code>  c c c c</code><br><code>  \bar ".." <br>}</code></pre>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/PolyMarkDir1.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir1-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir1-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir1-md.png 768w"  alt="" width="505" height="189"></figure>
<p>En utilisant les mêmes<code> \tweak</code> ou <code>\override</code> qu'avec<code> \mark</code> :</p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\relative c'' {</code><br><code>  c2 c  </code><br><code>  \polyMark #'myKey "UP"</code><br><code>  \tweak direction #DOWN</code><br><code>  \polyMark #'anotherKey \markup "DOWN"</code><br><code>  c c 2 c</code><br><code>  \once \override Score.RehearsalMark #'self-alignment-X = #RIGHT</code><br><code>  \once \override Score.RehearsalMark.break-visibility = #end-of-line-visible</code><br><code>  \polyMark #'EOF "End of Line"</code><br><code>  \bar ".." </code><br><code>}</code></pre>
<p class="msg msg--success">N.B. voir sur cette page la différence entre <code>\tweak</code> et <code>\override</code></p>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/PolyMarkDir3.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir3-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir3-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir3-md.png 768w"  alt="" width="507" height="104"></figure>
<p>En définissant dans un layout des valeurs associées à un identifiant</p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\score {</code><br><code>  \relative c'' {</code><br><code>    c2 c  c2 c</code><br><code>    \polyMark #'DC "D.C. al Coda"</code><br><code>    \bar ".." </code><br><code>  }</code><br><code>  \layout {</code><br><code>    \context { \Score</code><br><code>               polyMarkOptions = #`((DC</code><br><code>                                     (direction        . ,DOWN)</code><br><code>                                     (self-alignment-X . ,RIGHT)</code><br><code>                                     (break-visibility . ,begin-of-line-invisible)))</code><br><code>  } }</code><br><code>}</code></pre>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/PolyMarkDir2.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir2-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir2-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir2-md.png 768w"  alt="" width="499" height="105"></figure>
<p>Enfin j'ai gardé le meilleur pour la fin : il y a au sein du fichier poly-mark-engraver.ly une "<em>default-option-lists</em>" sur le modèle de polyMarkOptions et que l'on vient de voir et que l'on peut utiliser à tous moments sans avoir à les déclarer. Les identifiants parlent d'eux-mêmes et sont facile à retenir : RightUp, RightDown, Right, CenterEndUp, CenterEndDown, CenterEnd, LeftUp, LeftDown, Left, CenterUp, CenterDown, Center, CenterEndBoth, CenterEndBothRotated, CenterEndBothMirrore. Complétez-la avec des options que vous utilisez fréquemment : pour ma part j'ai ajouté RighEnd et RightEndDown. voici quelques exemples : </p>
<pre><code>\include "poly-mark-engraver.ly"<br><br>\relative c'' {</code><br><code>  c1  </code><br><code>  \polyMark #'Right \markup \with-color #red \musicglyph "scripts.varsegno"</code><br><code>  \tweak extra-offset #'(1 . -4.5)</code><br><code>  \polyMark #'Left \default</code><br><code>  c</code><br><code>  \polyMark #'Right "RightUp"</code><br><code>  \polyMark #'LeftDown "LeftDown"</code><br><code>  c</code><br><code>  \polyMark #'CenterEndBothRotated \markup \musicglyph "scripts.ufermata"  </code><br><code>  \bar ".." </code><br><code>}</code></pre>
<figure class="post__image align-center"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/18/PolyMarkDir4.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir4-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir4-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/18/responsive/PolyMarkDir4-md.png 768w"  alt="" width="505" height="109"></figure>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Lilypond : indications rythmiques</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/lilypond-indications-rythmiques.html"/>
        <id>https://myrealbook.vintherine.org/lilypond-indications-rythmiques.html</id>

        <updated>2022-07-01T10:40:57+02:00</updated>
            <summary>
                <![CDATA[
                    <p>Mise à jour du 1er juillet 2022 : diminution de la taille des notes des indications rythmiques et non transposabilité. Voir en fin d'article.</p>
<p>Lylipond dispose d'une instruction pour transformer les têtes de notes en formes de "slashes". Cela indique ordinairement une section où le musicien est libre de jouer les notes qu'il veut à condition de respecter le rythme. Par exemple :</p>
<p><img loading="lazy" src="http://lilypond.org/doc/v2.19/Documentation/3b/lily-25cb0b78.png" data-is-external-image="true"  alt="[image of music]" align="middle" border="0"></p>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Mise à jour du 1er juillet 2022 : diminution de la taille des notes des indications rythmiques et non transposabilité. Voir en fin d'article.</p>
<p>Lylipond dispose d'une instruction pour transformer les têtes de notes en formes de "slashes". Cela indique ordinairement une section où le musicien est libre de jouer les notes qu'il veut à condition de respecter le rythme. Par exemple :</p>
<p><img loading="lazy" src="http://lilypond.org/doc/v2.19/Documentation/3b/lily-25cb0b78.png" data-is-external-image="true"  alt="[image of music]" align="middle" border="0"></p>

<p>ce qui s'obtient par le code :</p>
<pre><code>\new Voice \with { \consists "Pitch_squash_engraver" } </code><br><code>\relative { </code><br><code>  e''8 e g a a16( bes) a8 g </code><br><code>  \improvisationOn e8 ~ 2 ~ 8 f4 f8 ~ 2 </code><br><code>  \improvisationOff a16( bes) a8 g e </code><br><code>}</code></pre>
<p>La section est limitée par <code>\improvisationOn ../.. \improvisation\Off</code></p>
<p>Par ailleurs c'est le contexte <code>\consists "Pitch_squash_engraver"</code> qui permet que toutes les notes s'affichent au centre de la portée. En son absence les notes s'afficheraient à leur emplacement ordinaire.</p>
<p>Ce type de notation est fréquemment utilisé en jazz pour la mise en place de tout ou partie de la section rythmique, ici dans la voix basse :</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/5/729313fb13a2421f812e5632ae41638a.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/5/responsive/729313fb13a2421f812e5632ae41638a-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/5/responsive/729313fb13a2421f812e5632ae41638a-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/5/responsive/729313fb13a2421f812e5632ae41638a-md.png 768w"  alt="" width="1084" height="220"></figure>
<p>Le code :</p>
<pre><code>\version "2.22.1"</code><br><br><code>#(set-global-staff-size 18)</code><br><code>\include "jazzchords.ily"</code><br><code>\include "lilyjazz.ily"</code><br><code>\include "jazzextras.ily"</code><br><br><br><code>theNotes = \relative c'' {</code><br><code> \clef "treble" \key bes \major \time 4/4</code><br><code> \override Rest #'staff-position = #0</code><br><code> r2 r8 es c4-. | bes2 es | a g | es4-. r ^\markup \small "Solo break..." r2</code><br><code>}</code><br><br><code>Rythme= \relative c' {</code><br><code> \improvisationOn</code><br><code> \override NoteHead.no-ledgers = ##t % pas de lignes additionelles</code><br><code> \override Rest #'staff-position = #-6 % position des silences</code><br><code> c4. 8~ 4 4 | r4 8 r8 2 | 2 2 | s1 </code><br><code>}</code><br><br><code>harmonies = \chordmode {</code><br><code> f4.:8 bes:13 bes/as g:8 c2:8 f:8 bes:9-13 es:6.9</code><br><code>}</code><br><br><code>\score {</code><br><code> &lt;&lt;</code><br><code> \new ChordNames {</code><br><code> \set chordChanges = ##t</code><br><code> \harmonies</code><br><code> }</code><br><code> \new Staff &lt;&lt;</code><br><code> \theNotes \\ \Rythme</code><br><code> &gt;&gt; &gt;&gt;</code><br><code>}</code></pre>
<p>On notera :</p>
<ul>
<li>l'absence de <code>\consists "Pitch_squash_engraver"</code> dans la voix rythmique et donc le positionnement des notes en fonction de leur valeur</li>
<li>le positionnement manuel des silences grâce à l'instruction <code>\override Rest #'staff-position</code> dans les deux voix </li>
</ul>
<p>Pour passer la voix en haut changer la valeur de <code>Rest #'staff-position</code> dans Rythme ( par exemple #6) et inverser les 2 voix <code class="inline-code">\Rythme \\ \theNotes</code></p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/5/3303fb7dc05041ce9e95b34b60fe1aea.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/5/responsive/3303fb7dc05041ce9e95b34b60fe1aea-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/5/responsive/3303fb7dc05041ce9e95b34b60fe1aea-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/5/responsive/3303fb7dc05041ce9e95b34b60fe1aea-md.png 768w"  alt="" width="1529" height="191"> </figure>
<p>Dans l'exemple qui suit la ligne de basse est totalement écrite et seul le rythme est indiqué pour le piano (ou la guitare). Les temps non significatifs sont remplacés par des slashes obtenus en remplacement les soupirs (voir la fonction <code>comp</code> dans le code ci-dessous)</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/5/8eca286f0b1e4b428d91a67f9ad15def.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/5/responsive/8eca286f0b1e4b428d91a67f9ad15def-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/5/responsive/8eca286f0b1e4b428d91a67f9ad15def-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/5/responsive/8eca286f0b1e4b428d91a67f9ad15def-md.png 768w"  alt="" width="1533" height="459"></figure>
<p>le code complet :</p>
<pre><code>\version "2.22.1"</code><br><br><code>#(set-global-staff-size 18)</code><br><code>\include "jazzchords.ily"</code><br><code>\include "lilyjazz.ily"</code><br><code>\include "jazzextras.ily"</code><br><br><code>comp = #(define-music-function (count) (integer?)</code><br><code>          #{</code><br><code>            \override Rest.stencil = #ly:percent-repeat-item-interface::beat-slash</code><br><code>            \override Rest.thickness = #0.48</code><br><code>            \repeat unfold $count { r4 }</code><br><code>            \revert Rest.stencil</code><br><code>          #}</code><br><code>          )</code><br><br><code>chordsRhythm = \relative c' {</code><br><code>  \override Rest #'staff-position = #8</code><br><code>  \improvisationOn \override NoteHead.no-ledgers = ##t</code><br><br><code>  \comp #3 e8 8~ | 4 \comp #3 | \comp #3 8 8~ | 4 \comp #3</code><br><code>  \comp #3 8 8~ | 4 8 8~ 4 \comp #3 r8 8 8 8~ | 4 \comp #3</code><br><code>}</code><br><br><code>Basse = \relative c {</code><br><code>  \override Rest #'staff-position = #0</code><br><code>  \clef "bass" \key as \major \time 4/4</code><br><code>  bes4 4 c8 4 des8~ | 2 r8 c f, c' | bes4 4 c8 4 des8~ | 4 r8 es16 e f c f,8 ~ 4 |</code><br><code>  bes4 4 c8 4 des8~ | 8 8 d es~ es4 g8 bes | as es as,4 8 g ges f8~ | 4. c'8 ges'4 f</code><br><code>}</code><br><br><code>harmonies = \chordmode {</code><br><code>  \set chordChanges = ##t</code><br><code>  bes2:m7 c4.:m7 des8:7+ s2 c:m7 bes2:m7 c4.:m7 des8:7+ s2 f:9+13-</code><br><code>  bes2:m7 c4.:m7 des8:7+ s2 es:7sus4 as:7+ s8 g:7 as:7/ges f:9- s1</code><br><code>}</code><br><br><code>\score {</code><br><code>  &lt;&lt;</code><br><code>    \new ChordNames { \harmonies }</code><br><code>    \new Staff \with {</code><br><code>      instrumentName = \markup {</code><br><code>        \column { "rhythm"</code><br><code>                  \line { "section" }</code><br><code>        }</code><br><code>      }</code><br><code>    }</code><br><code>    &lt;&lt;</code><br><code>      \chordsRhythm \\ \Basse</code><br><code>    &gt;&gt;</code><br><code>  &gt;&gt;</code><br><code>}</code><br><br></pre>
<hr>
<p>Mise à jour du 1er juillet 2022</p>
<p>il est possible de changer la taille des notes de la partie indications rythmiques pour rendre la partition plus lisible. Pour ceci on utilisera la commande<code> \magnifyMusic x { }</code> ou x sera inférieur à 1 pour des notes plus petites ou supérieur pou des notes plus grosses. Dans l'exemple ci-dessous x vaut 0.8</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/5/document.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/5/responsive/document-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/5/responsive/document-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/5/responsive/document-md.png 768w"  alt="" width="497" height="135"></figure>
<p>On notera également dans le code que la voix contient la propriété <code>\withMusicProperty untransposable ##t</code> Cela permet de ne pas changer la hauteur des notes rythmiques en cas de transposition de la partie.</p>
<p>Le code :</p>
<pre><code>\version "2.22.2"</code><br><code>\include "jazzchords.ily" % facultatif</code><br><code>\include "lilyjazz.ily" % facultatif</code><br>\score {<br>  &lt;&lt;<br>    \new ChordNames { <br>      \chordmode { as1:m7 des:7 ges:7+ c:9+ } }<br>    \relative c'' { <br>      \key des \major<br>      bes1 ~ | bes4. as8 r8 f4-. des8 |<br>      &lt;&lt; { \withMusicProperty untransposable ##t {<br>        { \magnifyMusic 0.8 {<br>          \improvisationOn <br>          \override NoteHead.no-ledgers = ##t <br>          b'' 4. 8~4 4~ 1 } } } } \\ { es,,1 ~ | es1 }<br>      &gt;&gt;<br>    }<br>  &gt;&gt;<br>}</pre>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Indication de Swing</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/indication-de-swing.html"/>
        <id>https://myrealbook.vintherine.org/indication-de-swing.html</id>

        <updated>2022-07-08T22:55:47+02:00</updated>
            <summary>
                <![CDATA[
                    <p>On trouve assez fréquemment des indications de Swing sous la forme </p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/30//Swing.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/30//responsive/Swing-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/30//responsive/Swing-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/30//responsive/Swing-md.png 768w"  alt="Swing" width="373" height="131"></figure>
<p>Voyons comment faire ceci sous Lilypond. Une solution "simple" est de loger tout ceci dans un <code>\markup</code> que l'on utilisera soit dans l'entête, ici dans <code>meter</code>, soit dans la musique elle-même.</p>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>On trouve assez fréquemment des indications de Swing sous la forme </p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/30//Swing.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/30//responsive/Swing-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/30//responsive/Swing-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/30//responsive/Swing-md.png 768w"  alt="Swing" width="373" height="131"></figure>
<p>Voyons comment faire ceci sous Lilypond. Une solution "simple" est de loger tout ceci dans un <code>\markup</code> que l'on utilisera soit dans l'entête, ici dans <code>meter</code>, soit dans la musique elle-même.</p>

<p>Dans ce <code>\markup</code> nous allons inclure une partition (<code>\score</code>) et une portée (<code>\new Staff</code>) contenant les 2 croches et le triolet, séparés par un silence invisible affecté d'une marque pour le signe égal.<br>Toutes les propriétés seront fixées dans le <code>\layout {}</code> </p>
<h5>La musique tient entièrement dans une ligne de code :</h5>
<pre><code>\relative { a'8[ 8] s2^\markup " = " \tuplet 3/2 { 4 8 } }</code></pre>
<h5>Voyons ensuite le <code>\layout {}</code></h5>
<h6>Utilise le nom d'instrument pour la zone textuelle Swing</h6>
<pre><code>\set Staff.instrumentName = \markup \fontsize #2  Swing</code></pre>
<h6>Pas de clef, de mesure ni d'armure</h6>
<pre><code>\omit Staff.Clef<br>\omit Staff.TimeSignature<br>\omit Staff.KeySignature</code></pre>
<h6>Supprime les lignes de la portée et les barres de mesures</h6>
<pre><code>\override Staff.StaffSymbol.line-count = #0<br>\override Score.BarLine.break-visibility = ##(#f #f #f)</code></pre>
<h6>Diminue la taille de la police</h6>
<pre><code>\set Staff.fontSize = #-1</code></pre>
<h6>Diminue l'écartement entre les lignes de la portée</h6>
<p>Permet de diminuer la hauteur des hampes, fixée en fonction de  l'écartement entre les lignes.</p>
<pre><code>\override Staff.StaffSymbol.staff-space = #(magstep -3)</code></pre>
<h6>Ajuste l'emplacement du <code>\markup</code> pour le signe =</h6>
<pre><code>\override Staff.TextScript #'extra-offset = #'( -0.7 . -1.8 )</code></pre>
<h6>Défini la taille de la portée</h6>
<p>Permet d'ajuster l'écart entre les notes</p>
<pre><code>line-width = #23</code></pre>
<h6>Défini l'indentation de la première ligne de la portée</h6>
<p>Permet de fixer l'écart entre l'indication textuel (Swing) et les notes</p>
<pre><code>indent = #1</code></pre>
<h5>Tout le code :</h5>
<pre><code>\version "2.22.2"</code><br><br><code>\include "lilyjazz.ily" % facultatif</code><br><br><code>swingMark = \markup  {</code><br><code>  \score { </code><br><code>    \new Staff</code> <code>\relative { </code><code>a'8[ 8] </code>s2^\markup " = " \tuplet 3/2 { 4 8 } }<br><code>    \layout {<br>      \set Staff.instrumentName = \markup \fontsize #2  Swing<br>      \omit Staff.Clef<br>      \omit Staff.TimeSignature<br>      \omit Staff.KeySignature<br>      \override Staff.StaffSymbol.line-count = #0<br>      \override Score.BarLine.break-visibility = ##(#f #f #f)<br>      \set Staff.fontSize = #-1<br>      \override Staff.StaffSymbol.staff-space = #(magstep -3)<br>      \override Staff.TextScript #'extra-offset = #'( -0.7 . -1.8 )<br>      line-width = #23<br>      indent = #1<br>    }}}</code><br><br><code>\header {</code><br><code>  meter = \swingMark</code><br><code>}</code><br><br><code>\repeat unfold 4 { c''1 } </code></pre>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Numérotation des pages</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/numerotation-des-pages.html"/>
        <id>https://myrealbook.vintherine.org/numerotation-des-pages.html</id>

        <updated>2022-03-15T14:25:33+01:00</updated>
            <summary>
                <![CDATA[
                    <p>Contrairement à l'édition papier le nombre de page d'une édition numérique (lecture sur tablette par ex.) n'est pas immédiatement visible. La manière la plus simple me paraît être d'utiliser la numérotation des pages sous la forme x/n où x est le numéro de la page en cours et n le nombre total de pages. Cela n'est pas prévu par défaut par Lilypond mais peut se contourner de la manière suivante.</p>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Contrairement à l'édition papier le nombre de page d'une édition numérique (lecture sur tablette par ex.) n'est pas immédiatement visible. La manière la plus simple me paraît être d'utiliser la numérotation des pages sous la forme x/n où x est le numéro de la page en cours et n le nombre total de pages. Cela n'est pas prévu par défaut par Lilypond mais peut se contourner de la manière suivante.</p>

<p><strong>Tout d'abord</strong> mettre un label à la toute fin de la partition (<code>\label #'theLastPage</code> par exemple). C'est le seul moyen de connaitre le nombre total de pages (<code>\page-ref #'theLastPage</code>).</p>
<p><strong>Ensuite</strong> ajouter les lignes suivantes dans le bloc paper</p>
<pre><code> \paper {</code><br><code> oddHeaderMarkup = \markup {</code><br><code>    \on-the-fly \print-page-number-check-first {</code><br><code>      \fill-line { \null \concat { \fromproperty #'page:page-number-string "/" \page-ref #'theLastPage "0" "?"} }</code><br><code>  } }</code><br><code>  evenHeaderMarkup = \markup {</code><br><code>    \on-the-fly \print-page-number-check-first {</code><br><code>      \fill-line { \concat { \fromproperty #'page:page-number-string "/" \page-ref #'theLastPage "0" "?"} \null }</code><br><code>  } } }</code></pre>
<p>la condition <code>\on-the-fly \print-page-number-check-first</code> vérifie que impression du numéro de page doit se faire y compris pour la première page, ce qui n'est  pas l'option par défaut. <strong>Donc</strong> dans les books ou bookparts concernés rajouter</p>
<pre>  <code>\paper {</code><br><code>   print-first-page-number = ##t</code><br><code>  }</code></pre>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/29//BeginTheBeguine.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/29//responsive/BeginTheBeguine-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/29//responsive/BeginTheBeguine-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/29//responsive/BeginTheBeguine-md.png 768w"  alt="" width="543" height="209"></figure>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Grille harmonique</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/grille-harmonique.html"/>
        <id>https://myrealbook.vintherine.org/grille-harmonique.html</id>

        <updated>2022-03-25T10:52:54+01:00</updated>
            <summary>
                <![CDATA[
                    <p>La grille harmonique (voir sur <a title="https://fr.wikipedia.org/wiki/Grille_harmonique">Wikipédia</a>) est paraît-il une spécificité du jazz français. Elle m'est souvent réclamée par la section rythmique qui la trouve plus facile à lire qu'une ligne d'accords au dessus d'une portée. </p>
<p>Voici les divisions que j'utilise (mesures à 4 temps, les chiffres dans les case indiquant l'ordre de lecture)</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/28//ordreAccords-2.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/28//responsive/ordreAccords-2-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/28//responsive/ordreAccords-2-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/28//responsive/ordreAccords-2-md.png 768w"  alt="" width="792" height="202"></figure>
<p>Jusqu'à ce jour le code Lilypond utilisé pour produire ce genre de grille tenait franchement de la bidouille et il fallait souvent mettre les mains dans le cambouis pour produire un résultat à peu près présentable. Je me suis donc décidé à re-porter ce problème sur la liste francophone des utilisateurs de Lilypond. <a title="https://lists.gnu.org/archive/html/lilypond-user-fr/2022-03/msg00014.html">Le fil de la discussion</a>.</p>
<p>Avec l'aide décisive de Jean, notre développeur en chef, je dispose enfin d'un code propre et lisible.</p>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>La grille harmonique (voir sur <a title="https://fr.wikipedia.org/wiki/Grille_harmonique">Wikipédia</a>) est paraît-il une spécificité du jazz français. Elle m'est souvent réclamée par la section rythmique qui la trouve plus facile à lire qu'une ligne d'accords au dessus d'une portée. </p>
<p>Voici les divisions que j'utilise (mesures à 4 temps, les chiffres dans les case indiquant l'ordre de lecture)</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/28//ordreAccords-2.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/28//responsive/ordreAccords-2-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/28//responsive/ordreAccords-2-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/28//responsive/ordreAccords-2-md.png 768w"  alt="" width="792" height="202"></figure>
<p>Jusqu'à ce jour le code Lilypond utilisé pour produire ce genre de grille tenait franchement de la bidouille et il fallait souvent mettre les mains dans le cambouis pour produire un résultat à peu près présentable. Je me suis donc décidé à re-porter ce problème sur la liste francophone des utilisateurs de Lilypond. <a title="https://lists.gnu.org/archive/html/lilypond-user-fr/2022-03/msg00014.html">Le fil de la discussion</a>.</p>
<p>Avec l'aide décisive de Jean, notre développeur en chef, je dispose enfin d'un code propre et lisible.</p>

<p>Voici un exemple minimal avec reprise alternative :</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/28//DemoChordGrid.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/28//responsive/DemoChordGrid-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/28//responsive/DemoChordGrid-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/28//responsive/DemoChordGrid-md.png 768w"  alt="" width="783" height="285"></figure>
<p>Tout d'abord il est nécessaire d'enregistrer et d'inclure la fonction codée par Jean, modifiée par mes soins  pour augmenter la taille des cases, téléchargeable <a href="https://acloud.zaclys.com/index.php/s/SJeiZD7oxbn8G62">depuis mon cloud</a>. </p>
<p>Pour l'inclure reportez vous <a href="https://lilypond.org/doc/v2.22/Documentation/notation/including-lilypond-files.html">à cette page</a> ou, si vous utilisez Frescobaldi, sauvegardez le dans un répertoire que vous aurez préalablement désigné comme répertoire d'inclusion. Voir <a href="https://frescobaldi.org/uguide.fr.html#help_preferences_lilypond">le manuel en ligne</a>. </p>
<p>La grille est décrite à la manière d'un <a href="https://lilypond.org/doc/v2.22/Documentation/notation/chord-mode">chordmode</a> en intégrant les sauts de ligne (<code>\break</code>) : même nombre de cases par ligne, en principe 4.  Jean s'est bien proposé de coder un saut automatique mais d'une part cela ne fonctionne pas encore et d'autre part cela n'est pas bien pénible de saisir un <code>\break</code> manuellement </p>
<p>Pour les reprises alternatives, comme vous pouvez le voir ci-dessus, l'idée est de faire une ligne représentant la 2ème alternative en n'affichant que la ou les mesure(s) différenciée(s). Pour ne pas faire de cases vides on remplace les autres par des <code>s1 </code>(silences invisibles) et des <code>\bar ""</code> (barres invisibles) entourés d'un <code>\stopStaff </code>et d'un <code>\startStaff</code></p>
<p>Voici le code de l'exemple ci-dessus</p>
<pre><code>\version "2.22.2"</code><br><code>\include "jazzchords.ily"    % Si vous utilisez Lilyjazz</code><br><code>\include "lilyjazz.ily"      % Si vous utilisez Lilyjazz</code><br><code>\include "chord-grid-JAS.ly" % la fonction codée par Jean Abou-Samra</code><br><br><code>#(set-global-staff-size 18)</code><br><br><code>\paper {</code><br><code>  #(set-paper-size "a4")</code><br><code>  indent = 0</code><br><code>}</code><br><br><code>\layout {</code><br><code>  \context {</code><br><code>    \Score</code><br><code>    startRepeatType = #"[|:"</code><br><code>    endRepeatType = #":|]"</code><br><code>    doubleRepeatType = #":|][|:"</code><br><code>   }</code><br><code>}</code><br><br><code>mus = \chordmode {  <br>% la grille proprement dite, 1 ligne par case</code><br><code>  g1:m7+</code><br><code>  a2:m5-7 d:5+7</code><br><code>  a4:m5-7 d2.:5+7</code><br><code>  a2.:m5-7 d4:5+7</code><br><code>  \break</code><br><code>  a4:m5-7 d:5+7 g2:m7</code><br><code>  g2:m7+ a4:m5-7 d:5+7</code><br><code>  g4:m7+ e:m5-7 a:m5-7 d:5+7</code><br><code>  \set Score.repeatCommands = #'((volta "1.") )</code><br><code>  a2:m5-7 d:5+7</code><br><code>  \set Score.repeatCommands = #'((volta #f) end-repeat)</code><br><code>  \break</code><br><code>  \stopStaff s1 \bar "" s \bar "" s \startStaff</code><br><code>  \set Score.repeatCommands = #'((volta "2.") )</code><br><code>  g1:m6</code><br><code>  \set Score.repeatCommands = #'((volta #f))</code><br><code>  \bar ".."</code><br><code>}</code><br><br><code>\score {</code><br><code> \gridLayout  % layout enregistré dans le fichier inclus "chord-grid-JAS.ly"</code><br><code> \new ChordGrid \mus</code><br><code>}</code></pre>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Reprises alternatives avec MuseScore</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/reprises-alternatives-avec-musescore.html"/>
        <id>https://myrealbook.vintherine.org/reprises-alternatives-avec-musescore.html</id>

        <updated>2022-01-26T22:00:01+01:00</updated>
            <summary>
                <![CDATA[
                    <p>Il n'y a pas que Lilypond dans la vie, il y a aussi <a href="https://musescore.org/fr">MuseScore</a>. S'il se présente également comme éditeur de partitions (wysiwyg celui-ci) je l'utilise pour ses capacité à jouer  les partitions avec son synthétiseur intégré : c'est avec cet outil que je travaille à mes compositions, arrangements, relevées ou bande d'accompagnement.  </p>
<p>S'il est somme toute très simple à prendre en main il y a quelques fonctionnalités pas vraiment intuitives. C'est le cas des reprises lorsqu'une alternative  doit être jouée plus de 2 fois. Par exemple :</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/27//2022-01-26-1643230195_3840x1080_scrot.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/27//responsive/2022-01-26-1643230195_3840x1080_scrot-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/27//responsive/2022-01-26-1643230195_3840x1080_scrot-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/27//responsive/2022-01-26-1643230195_3840x1080_scrot-md.png 768w"  alt="" width="583" height="465"></figure>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Il n'y a pas que Lilypond dans la vie, il y a aussi <a href="https://musescore.org/fr">MuseScore</a>. S'il se présente également comme éditeur de partitions (wysiwyg celui-ci) je l'utilise pour ses capacité à jouer  les partitions avec son synthétiseur intégré : c'est avec cet outil que je travaille à mes compositions, arrangements, relevées ou bande d'accompagnement.  </p>
<p>S'il est somme toute très simple à prendre en main il y a quelques fonctionnalités pas vraiment intuitives. C'est le cas des reprises lorsqu'une alternative  doit être jouée plus de 2 fois. Par exemple :</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/27//2022-01-26-1643230195_3840x1080_scrot.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/27//responsive/2022-01-26-1643230195_3840x1080_scrot-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/27//responsive/2022-01-26-1643230195_3840x1080_scrot-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/27//responsive/2022-01-26-1643230195_3840x1080_scrot-md.png 768w"  alt="" width="583" height="465"></figure>

<p>Il faut :</p>
<ul>
<li>Sélectionner la ligne alternative précédant la barre de reprise (1.2.3)</li>
<li>Afficher l'inspecteur (touche de fonction F8 ou menu affichage)</li>
<li>Éditer la zone texte de début</li>
<li>Remplir tout en bas la liste des reprises qui doivent être jouées</li>
<li>Sélectionner la mesure précédant la barre de reprise</li>
<li>Par le menu contextuel (bouton droit) éditer les propriétés de la mesure</li>
<li>Dans nombres de lectures indiquer le nombre correspondant à la liste des reprises +1</li>
</ul>
<p>Un bon dessin vaut mieux qu'un long discours ?</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/27//RepriseMS.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/27//responsive/RepriseMS-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/27//responsive/RepriseMS-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/27//responsive/RepriseMS-md.png 768w"  alt="" width="1092" height="658"></figure>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Le principe de la moindre altération</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/le-principe-de-la-moindre-alteration.html"/>
        <id>https://myrealbook.vintherine.org/le-principe-de-la-moindre-alteration.html</id>

        <updated>2022-01-23T15:45:16+01:00</updated>
            <summary>
                <![CDATA[
                    <p>Une particularité de Lilypond est de pouvoir stocker des fragments musicaux dans des variables et de pouvoir les réutiliser où bon nous semble et comme bon nous semble. En les transposant notamment. Mais par défaut le résultat n'est pas toujours lisible !</p>
<p>Pour les notes il suffit  souvent d'un peu d'astuce. Par exemple si l'on veut transposer un La♯ d'une tierce mineure en dessous (transposer une partie de violon pour un saxophone alto) cela nous donnera un Fa<span class="wdg-select-all-ok">𝄪 mais si on le transpose d'une seconde augmentée (1 ton ½ également) cela nous donnera un Sol. Voici ce que donne ce principe appliqué à la gamme de Si majeur (code ci-dessous)</span></p>
<figure class="post__image" ><img loading="lazy" src="https://myrealbook.vintherine.org/media/posts/26/document-3.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/26/responsive/document-3-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/26/responsive/document-3-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/26/responsive/document-3-md.png 768w"  alt="" width="570" height="300">
<figcaption >Transposition pour saxophones</figcaption>
</figure>
<p> </p>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Une particularité de Lilypond est de pouvoir stocker des fragments musicaux dans des variables et de pouvoir les réutiliser où bon nous semble et comme bon nous semble. En les transposant notamment. Mais par défaut le résultat n'est pas toujours lisible !</p>
<p>Pour les notes il suffit  souvent d'un peu d'astuce. Par exemple si l'on veut transposer un La♯ d'une tierce mineure en dessous (transposer une partie de violon pour un saxophone alto) cela nous donnera un Fa<span class="wdg-select-all-ok">𝄪 mais si on le transpose d'une seconde augmentée (1 ton ½ également) cela nous donnera un Sol. Voici ce que donne ce principe appliqué à la gamme de Si majeur (code ci-dessous)</span></p>
<figure class="post__image" ><img loading="lazy" src="https://myrealbook.vintherine.org/media/posts/26/document-3.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/26/responsive/document-3-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/26/responsive/document-3-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/26/responsive/document-3-md.png 768w"  alt="" width="570" height="300">
<figcaption >Transposition pour saxophones</figcaption>
</figure>
<p> </p>

<pre>\version "2.22.1"<br><br>theNotes = \relative c' { <br>  \key b \major<br>  b4 cis dis e fis gis ais b~ | 1 }<br><br>\layout {<br>  indent = 5\cm<br>}<br><br>\score {<br>  &lt;&lt;<br>    \new Staff \with { <br>      instrumentName = \markup {<br>        \center-column { "Instruments"<br>                         \line { "en Do" } } } }<br>    \theNotes<br>    \new Staff \with { <br>      instrumentName = \markup {<br>        \center-column { \line { "Instrument en Si" \smaller \flat }<br>                         \line { "\\transpose c d (1 ton)" } } } }<br>    \transpose c d \theNotes<br>    \new Staff \with { <br>      instrumentName = \markup {<br>        \center-column { \line { "Instrument en Si" \smaller \flat }<br>                         \line { "\\transpose c eses (1 ton)" } } } }<br>    \transpose c eses \theNotes<br>    \new Staff \with { <br>      instrumentName = \markup {<br>        \center-column { \line { "Instrument en Mi" \smaller \flat }<br>                         \line { "\\transpose c a (4 tons  ½)" } } } }<br>    \transpose c a \theNotes<br>    \new Staff \with { <br>      instrumentName = \markup {<br>        \center-column { \line { "Instrument en Mi" \smaller \flat }<br>                         \line { "\\transpose c beses (4 tons  ½)" } } } }<br>    \transpose c beses \theNotes<br>  &gt;&gt;<br>}</pre>
<p>Pour les accords le même problème se pose mais est un petit peu plus compliqué à résoudre en utilisant la propriété chordRootNamer (voir code ci-dessous et <a href="https://lilypond.org/doc/v2.23/Documentation/notation/displaying-chords.fr.html">cette page de documentation</a>) . Ici ce n'est plus l'intervalle de transposition qui varie mais directement la base de l'accord via un double procédé enharmonique. Merci encore Jean.</p>
<figure class="post__image" ><img loading="lazy" src="https://myrealbook.vintherine.org/media/posts/26/document-4.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/26/responsive/document-4-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/26/responsive/document-4-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/26/responsive/document-4-md.png 768w"  alt="" width="583" height="303">
<figcaption >Fm7 c'est plus intuitif que E♯m7 n'est-ce-pas ?</figcaption>
</figure>
<p> </p>
<pre>\version "2.22.1"<br><br>#(use-modules (ice-9 match))<br><br>#(define enharmonization<br>   #((0 . 0) ; C♮<br>             (0 . 1/2) ; D♭ → C ♯<br>             (1 . 0) ; D♮<br>             (2 . -1/2) ; D♯ → E♭<br>             (2 . 0) ; E♮<br>             (3 . 0) ; F♮<br>             (3 . -1/2) ; G♭ → F♯<br>             (4 . 0) ; G♮<br>             #f ; G♯/A♭<br>             (5 . 0) ; A♮<br>             (6 . -1/2) ; A♯ → B♭<br>             (6 . 0) ; B♮<br>             ))<br><br>#(define (enharmonize pitch)<br>   (let* ((semitones (ly:pitch-semitones pitch))<br>          (normalized-semitones (modulo semitones 12))<br>          (eventual-octave (* 1/12 (- semitones normalized-semitones))))<br>     (match (vector-ref enharmonization normalized-semitones)<br>            ((best-name . best-alteration)<br>             (ly:make-pitch eventual-octave best-name best-alteration))<br>            (#f<br>             ;; G♯/A♭<br>             (if (positive? (ly:pitch-alteration pitch))<br>                 (ly:make-pitch eventual-octave 4 1/2)<br>                 (ly:make-pitch eventual-octave 5 -1/2))))))<br><br>%% Tests<br>#(for-each<br>  (match-lambda<br>   ((input output)<br>    (let ((processed (enharmonize input)))<br>      (if (not (equal? output (enharmonize input)))<br>          (ly:error "~s -&gt; ~s: bad output, expected ~s" input processed output)))))<br>  `((,#{ c #} ,#{ c #})<br>    (,#{ cis #} ,#{ cis #})<br>    (,#{ des #} ,#{ cis #})<br>    (,#{ des'' #} ,#{ cis'' #})<br>    (,#{ bisis #} ,#{ cis' #})<br>    (,#{ eeses #} ,#{ d #})<br>    (,#{ gis,, #} ,#{ gis,, #})<br>    (,#{ aes,, #} ,#{ aes,, #})<br>    (,#{ fisis,, #} ,#{ g,, #})))<br><br>\layout {<br>  indent = 4\cm<br>}<br><br>theNotes = { \repeat unfold 6 { R1 } }<br>theChords = \chordmode { gis1:m7 cis:7 fis:7+ g:m7 c:7 f:7+}<br><br>\score {<br>  &lt;&lt;<br>    \new ChordNames \theChords<br>    \new Staff \with { <br>      instrumentName = \markup {<br>        \center-column { "Instruments"<br>                         \line { "en Do" } } } }<br>    \theNotes<br>  &gt;&gt;<br>}<br><br>\score {<br>  &lt;&lt;<br>    \new ChordNames \transpose c a \theChords<br>    \new Staff \with { <br>      instrumentName = \markup {<br>        \center-column { \concat { "Pour inst. en Mi" \smaller \flat}<br>                         \line { "sans enharmonisation" } } } }<br>  \theNotes<br>  &gt;&gt;<br>} <br><br>\score {<br>  &lt;&lt;<br>    \new ChordNames \transpose c a \theChords<br>    \new Staff \with { <br>      instrumentName = \markup {<br>        \center-column { \concat { "Pour inst. en Mi" \smaller \flat}<br>                         \line { "avec enharmonisation" } } } } <br>    \theNotes<br>  &gt;&gt;<br>  \layout {<br>    \context {<br>      \ChordNames<br>      chordRootNamer =<br>      #(lambda (pitch lowercase)<br>         (note-name-&gt;markup (enharmonize pitch)<br>                            lowercase))<br>    }<br>  }<br>} </pre>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Fragments alternatifs : utilisation des tags</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/fragments-alternatifs-utilisation-des-tags.html"/>
        <id>https://myrealbook.vintherine.org/fragments-alternatifs-utilisation-des-tags.html</id>

        <updated>2022-01-10T17:42:48+01:00</updated>
            <summary>
                <![CDATA[
                    <p>Dans les répertoires de MyRealBook vous trouverez  des partitions écrites pour instruments en Do, en Si♭ et en Mi♭. Du fait de leur faible tessiture (2,5 octaves) les saxophones me servent de référence pour les instruments transposés.</p>
<p>Les fichiers sources sont d'abord écrits pour instruments en Do, les notes des différentes portées stockées dans des variables,  puis transposées. C'est en principe très simple : \transpose c d  \maMusique pour instruments en Si♭, \transpose c a  (ou a,) pour instruments en Mi♭. Mais il arrive parfois que l'<a href="https://fr.wikipedia.org/wiki/Ambitus">ambitus</a> du morceau soit tel que la partition  transposée soit injouable. </p>
<p>Voici par exemple la première partie de  <em>Zebulon Dance</em> de Didier Lockwood écrit originellement pour violon :</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/24/ZebulonDance-CTab.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/24/responsive/ZebulonDance-CTab-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/24/responsive/ZebulonDance-CTab-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/24/responsive/ZebulonDance-CTab-md.png 768w"  alt="Zebulon Dance" width="870" height="284"></figure>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Dans les répertoires de MyRealBook vous trouverez  des partitions écrites pour instruments en Do, en Si♭ et en Mi♭. Du fait de leur faible tessiture (2,5 octaves) les saxophones me servent de référence pour les instruments transposés.</p>
<p>Les fichiers sources sont d'abord écrits pour instruments en Do, les notes des différentes portées stockées dans des variables,  puis transposées. C'est en principe très simple : \transpose c d  \maMusique pour instruments en Si♭, \transpose c a  (ou a,) pour instruments en Mi♭. Mais il arrive parfois que l'<a href="https://fr.wikipedia.org/wiki/Ambitus">ambitus</a> du morceau soit tel que la partition  transposée soit injouable. </p>
<p>Voici par exemple la première partie de  <em>Zebulon Dance</em> de Didier Lockwood écrit originellement pour violon :</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/24/ZebulonDance-CTab.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/24/responsive/ZebulonDance-CTab-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/24/responsive/ZebulonDance-CTab-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/24/responsive/ZebulonDance-CTab-md.png 768w"  alt="Zebulon Dance" width="870" height="284"></figure>

<p>L'ambitus couvre un peu de deux octaves, du La3 au Si5. <span style="color: var(--text-editor-body-color); font-family: var(--font-base); font-size: inherit; font-weight: var(--font-weight-normal);">L'ambitus transposé pour un instrument en Si♭ (Si4 - Do♯6) sera compatible avec un saxophone soprano ou joué une octave en dessous par un saxophone ténor.</span></p>
<p>Tentons maintenant de transposer pour un saxophone alto :</p>
<ol>
<li>avec \transpose c a l'ambitus sera Fa♯3 - Sol♯5 : trop bas 😣</li>
<li>avec \transpose c a' l'ambitus sera Fa♯4 - Sol♯6 : trop haut 😣</li>
</ol>
<p>La solution la plus évidente est de monter d'une octave les seules notes posant problème (entourées de rouge ci-dessus). Pour éviter la solution "<em>bestiale</em>" consistant à dupliquer toute la portée pour ne changer que 7 notes on peut isoler les fragments alternatifs en utilisant des balises (tags). <a href="https://lilypond.org/doc/v2.22/Documentation/notation/different-editions-from-one-source#using-tags">La documentation est ici</a>. </p>
<p>Cette solution est d'autant plus facile dans notre cas qu'il suffit de changer l’octave des fragments en question dans la commande \relative. Exemple de code pour les 3  mesures de la 1ère alternative</p>
<pre>maMusique = \relative c''<br>{<br>  \key a \major cis4  a8  e  b' cis4  a8 ~ | a4  <br>  &lt;&lt; <br>    \tag violon \relative b { b8  cis  a2  } <br>    \tag alto \relative b' { b8  cis  a2  }<br>  &gt;&gt;<br>  r2 r8  e  a  cis \bar ":|."<br>}<br><br>&lt;&lt;  \new Staff \with { instrumentName = "violon" } \keepWithTag violon \maMusique<br>    \new Staff \with { instrumentName = "alto sax" } \keepWithTag alto \transpose c a, \maMusique <br>&gt;&gt;</pre>
<p>Le résultat :</p>
<figure class="post__image"><img loading="lazy"  src="https://myrealbook.vintherine.org/media/posts/24/LilyBalises.png" sizes="(max-width: 48em) 100vw, 100vw" srcset="https://myrealbook.vintherine.org/media/posts/24/responsive/LilyBalises-xs.png 300w ,https://myrealbook.vintherine.org/media/posts/24/responsive/LilyBalises-sm.png 480w ,https://myrealbook.vintherine.org/media/posts/24/responsive/LilyBalises-md.png 768w"  alt="Lily balise" width="540" height="143"></figure>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Lilypond et la pagination</title>
        <author>
            <name>Vincent</name>
        </author>
        <link href="https://myrealbook.vintherine.org/lilypond-et-la-pagination.html"/>
        <id>https://myrealbook.vintherine.org/lilypond-et-la-pagination.html</id>

        <updated>2022-01-04T11:12:10+01:00</updated>
            <summary>
                <![CDATA[
                    <p>À priori Lilypond permet de gérer finement la plupart des problèmes de pagination grâce à des variables dans les blocs <samp>\paper {}</samp></p>
<ul>
<li>afficher les numéros de pages (<samp>print-page-number = ##t</samp>, oui par défaut) ou non (<samp>##f</samp>)</li>
<li>afficher le numéro de la première page (<samp>print-first page-number = ##f</samp>, non par défaut)</li>
<li>afficher les numéros en chiffres arabes (<samp>page-number-type = 'arabic</samp>,  par défaut),  romains minuscules ( <samp>'roman-lower</samp>) ou romains majuscules ( <samp>'roman-upper</samp>)</li>
<li>Changer le numéro de la première page avec <samp>first-page-number</samp>. La valeur par défaut est de <samp>#1</samp>.</li>
</ul>

                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>À priori Lilypond permet de gérer finement la plupart des problèmes de pagination grâce à des variables dans les blocs <samp>\paper {}</samp></p>
<ul>
<li>afficher les numéros de pages (<samp>print-page-number = ##t</samp>, oui par défaut) ou non (<samp>##f</samp>)</li>
<li>afficher le numéro de la première page (<samp>print-first page-number = ##f</samp>, non par défaut)</li>
<li>afficher les numéros en chiffres arabes (<samp>page-number-type = 'arabic</samp>,  par défaut),  romains minuscules ( <samp>'roman-lower</samp>) ou romains majuscules ( <samp>'roman-upper</samp>)</li>
<li>Changer le numéro de la première page avec <samp>first-page-number</samp>. La valeur par défaut est de <samp>#1</samp>.</li>
</ul>

<p>Une chose pourtant fait défaut malgré des demandes répétées depuis de longues années : ce paramétrage ne fonctionne qu'au niveau du bloc <samp>\book</samp> et reste sans effet au niveau du bloc <samp>\bookpart</samp>. Voici au moins deux exemples pour lesquels cette limitation pose problème :</p>
<ul>
<li>Au début d'un ouvrage une préface ou une table des matière sera couramment numérotée en chiffres romains, la suite recommençant à 1 en chiffres arabes.</li>
<li>Pour des partitions pour orchestre on aimerait que directeur et parties soient regroupées dans un même ouvrage mais que la numérotation de chaque partie débute à 1.</li>
</ul>
<p>Il existe heureusement une solution de contournement que l'on doit initialement à Thomas Morley (voir <a href="https://www.mail-archive.com/lilypond-user@gnu.org/msg115188.html">cette page des archives de la liste anglophone des utilisateurs de Lilypond</a>) et récemment corrigée par Valentin Petzel sur la même liste.</p>
<p>Une remarque concernant l'exemple fourni avec le code repose sur la version 2.19 de Lilypond qu'il faut mettre à jour avec convert-ly (modifications de <samp>\tocItem</samp>  qui nécessite un <samp>\markup</samp>)</p>
<p>Pour utiliser cette solution copiez tout d'abord dans votre code la fonction ci-dessous (à la fin de cet article) ou collez-la dans un fichier à inclure et insérez un bloc <samp>\paper {}</samp> à l'intérieur  des <samp>\bookpart</samp> avec les variables suivantes :</p>
<ul>
<li><samp>oddHeaderMarkup = \oddMarkup #'arabic</samp></li>
<li><samp>evenHeaderMarkup = \evenMarkup #'arabic</samp></li>
</ul>
<p>arabic peut être remplacé par roman-lower ou roman-upper</p>
<p>La variable <samp>print-first page-number</samp> est maintenant par défaut à <samp>##t</samp> mais peut être modifiée dans ce même bloc</p>
<p>Un exemple :</p>
<pre><code>\version "2.22.1"</code><br><code>\include "BookPartPagesNumber.ly"</code><br><br><code>musique = \relative c'' { \repeat unfold 2 { d1 \pageBreak } }</code><br><br><code>\book {</code><br><code>  \bookpart {</code><br><code>    \paper {</code><br><code>      oddHeaderMarkup = \oddMarkup #'roman-lower</code><br><code>      evenHeaderMarkup = \evenMarkup #'roman-lower</code><br><code>    }</code><br><code>    \score {</code><br><code>      \musique</code><br><code>    }</code><br><code>  }</code><br><code>  \bookpart {</code><br><code>    \paper {</code><br><code>      print-first-page-number = ##f</code><br><code>      oddHeaderMarkup = \oddMarkup #'arabic</code><br><code>      evenHeaderMarkup = \evenMarkup #'arabic</code><br><code>    }</code><br><code>    \score {</code><br><code>      \musique</code><br><code>    }</code><br><code>        \score {</code><br><code>      \musique</code><br><code>    }</code><br><code>  }</code><br><code>}</code></pre>
<p>La fonction BookPartPagesNumber</p>
<pre>\<code>version "2.22.1"</code><br><br><code>#(define part-first-pages '(0))</code><br><br><code>#(define (part-first-page? layout props)</code><br><code>  (= (chain-assoc-get 'page:page-number props -1)</code><br><code>     (ly:output-def-lookup layout 'first-page-number)))</code><br><br><code>#(define (reset-part-first-page layout props arg)</code><br><code>"Returns page-number-string, starting every bookpart with page-number 0.</code><br><code>Relying on the extern defined `part-first-pages'.</code><br><code>"</code><br><code>  (set! props (prepend-alist-chain 'part-first-page '(0) props))</code><br><br><code>  (let* ((real-page-number (chain-assoc-get 'page:page-number props -1))</code><br><code>         (parts-page-number (- real-page-number (car part-first-pages))))</code><br><br><code>    (if (part-first-page? layout props)</code><br><code>        (set! part-first-pages (cons (1- real-page-number) part-first-pages)))</code><br><br><code>    (set! props</code><br><code>      (cons</code><br><code>        (list</code><br><code>          (cons 'page:page-number-string (number-&gt;string parts-page-number))</code><br><code>          (cons 'page:page-number parts-page-number))</code><br><code>        props))</code><br><code>    (interpret-markup layout props arg)))</code><br><br><code>#(define ((print-part-first-page-as-one number-type) layout props arg)</code><br><br><code>  (set! props</code><br><code>    (cons</code><br><code>      (list</code><br><code>        (cons 'page:page-number-string</code><br><code>              (let ((page-number</code><br><code>                     (chain-assoc-get 'page:page-number props -1)))</code><br><code>                ;(if (&lt;= page-number 0) ""</code><br><code>                (cond ((and (eq? number-type 'roman-lower) (&gt; page-number 0))</code><br><code>                       (fancy-format #f "~(~@r~)" page-number))</code><br><code>                      ((and (eq? number-type 'roman-upper) (&gt; page-number 0))</code><br><code>                       (fancy-format #f "~@r" page-number))</code><br><code>                          ((eq? number-type 'arabic)</code><br><code>                           (number-&gt;string page-number))</code><br><code>                          (else (number-&gt;string page-number)))));)</code><br><code>        (cons 'page:page-number</code><br><code>              (chain-assoc-get 'page:page-number props -1)))</code><br><code>      props))</code><br><code>  (interpret-markup layout props arg))</code><br><br><code>\paper {</code><br><code>  print-first-page-number = ##t</code><br><code>  oddMarkup =</code><br><code>  #(define-scheme-function (number-type)(symbol?)</code><br><code>    #{</code><br><code>      \markup</code><br><code>        \column {</code><br><code>          \fill-line {</code><br><code>            " "</code><br><code>            \on-the-fly #not-part-first-page \fromproperty #'header:instrument</code><br><code>              %% use in this order:</code><br><code>              \on-the-fly #reset-part-first-page</code><br><code>              \on-the-fly #(print-part-first-page-as-one number-type)</code><br><code>              \on-the-fly #print-page-number-check-first</code><br><code>              \fromproperty #'page:page-number-string</code><br><code>          }</code><br><code>        }</code><br><code>    #})</code><br><br><code>  evenMarkup =</code><br><code>  #(define-scheme-function (number-type)(symbol?)</code><br><code>    #{</code><br><code>      \markup</code><br><code>        \column {</code><br><code>          \fill-line {</code><br><code>              %% use in this order:</code><br><code>              \on-the-fly #reset-part-first-page</code><br><code>              \on-the-fly #(print-part-first-page-as-one number-type)</code><br><code>              \on-the-fly #print-page-number-check-first</code><br><code>              \fromproperty #'page:page-number-string</code><br><code>            \on-the-fly #not-part-first-page \fromproperty #'header:instrument</code><br><code>            " "</code><br><code>          }</code><br><code>        }</code><br><code>    #})</code><br><code>}</code></pre>
<p> </p>
            ]]>
        </content>
    </entry>
</feed>
